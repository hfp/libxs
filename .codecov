#!/bin/bash

#
# This script is supposed to be source'd prior to building the library and samples using GNU GCC.
# Executing LIBXS_COVERAGE (after building/running a case) yields code coverage information.
#
if [[ "${CXX}" == "g++" ]]; then
  if [[ "${TRAVIS_BUILD_DIR}" == "" ]]; then
    TRAVIS_BUILD_DIR=.
  fi
  FIND=$(which find)
  GCOV=$(which gcov)
  export EFLAGS="--coverage" ELDFLAGS="--coverage" \
    LIBXS_RUNGCOV="${FIND} ${TRAVIS_BUILD_DIR} -type f -name '*.gcno' -exec ${GCOV} -pb {} +" \
    LIBXS_CODECOV="codecov"
else
  unset EFLAGS ELDFLAGS
  export LIBXS_RUNGCOV=true
  export LIBXS_CODECOV=true
fi

